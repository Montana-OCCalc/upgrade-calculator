<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upgrade & Warranty Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;margin:0;background:#f5f5f5}
header{background:#0b3c5d;color:#fff;padding:12px;text-align:center}
nav{display:flex;background:#fff;border-bottom:1px solid #ccc}
nav button{flex:1;padding:10px;border:none;background:none;font-weight:600}
nav button.active{color:#0b3c5d;border-bottom:3px solid #0b3c5d}
section{display:none;padding:15px}
section.active{display:block}
table{border-collapse:collapse;font-size:12px}
td{border:1px solid #ccc;padding:4px;min-width:60px}
td:hover{background:#dfefff;cursor:pointer}
.note{font-size:12px;color:#555}
select,input{width:100%;padding:8px;margin-top:6px}
</style>
</head>
<body>

<header>
<h2>Upgrade & Warranty Calculator</h2>
</header>

<nav>
<button class="active" onclick="showTab('excel')">Excel</button>
<button onclick="showTab('inputs')">Inputs</button>
<button onclick="showTab('results')">Results</button>
</nav>

<section id="excel" class="active">
<h3>Excel Upload & Mapping</h3>
<input type="file" id="file" accept=".xlsx,.xls,.ods"><br><br>
<select id="sheetSelect"></select>
<div id="grid"></div>
<p class="note">Click a cell, then choose what it represents.</p>
</section>

<section id="inputs">
<h3>Inputs</h3>
<div id="inputStatus" class="note">Mapped inputs will appear here.</div>
</section>

<section id="results">
<h3>Results</h3>
<div class="note">Mapped result cells will be read here.</div>
</section>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
let workbook;
let mappings = JSON.parse(localStorage.getItem('cellMappings')||'{}');

const fields = [
 'Perimeter Length',
 'Valley Length',
 'Number of Squares',
 'Ridge Length',
 'Ridge Vent Upgrade',
 'Ice & Water Barrier Upgrade',
 'Slope Pitch Tier',
 'Shingle Upgrade'
];

function showTab(id){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 event.target.classList.add('active');
}

document.getElementById('file').addEventListener('change', e=>{
 const reader = new FileReader();
 reader.onload = evt=>{
  const data = new Uint8Array(evt.target.result);
  workbook = XLSX.read(data,{type:'array'});
  const sel=document.getElementById('sheetSelect');
  sel.innerHTML='';
  workbook.SheetNames.forEach(n=>{
    const o=document.createElement('option');
    o.value=n;o.text=n;sel.appendChild(o);
  });
  loadSheet(workbook.SheetNames[0]);
 };
 reader.readAsArrayBuffer(e.target.files[0]);
});

document.getElementById('sheetSelect').addEventListener('change',e=>{
 loadSheet(e.target.value);
});

function loadSheet(name){
 const sheet=workbook.Sheets[name];
 const html=XLSX.utils.sheet_to_html(sheet,{editable:false});
 const grid=document.getElementById('grid');
 grid.innerHTML=html;
 grid.querySelectorAll('td').forEach(td=>{
  td.onclick=()=>mapCell(td.getAttribute('id'));
 });
}

function mapCell(cell){
 const choice=prompt(
  'Map cell '+cell+' to one of these:\n\n'+fields.join('\n')
 );
 if(fields.includes(choice)){
  mappings[choice]=cell;
  localStorage.setItem('cellMappings',JSON.stringify(mappings));
  document.getElementById('inputStatus').innerText=
    'Mapped fields: '+Object.keys(mappings).join(', ');
 }
}
</script>

</body>
</html>
